<html><head><title>TLSServer.pb</title><meta charset=~"utf-8"></head>
<body bgcolor="#FFFFDF" link="#009999" vlink="#006666" alink="#006666">
<pre><font face="Courier New, Courier, mono" size="2"><font color="#006666">;
</font><font color="#006666">; ------------------------------------------------------------
</font><font color="#006666">;
</font><font color="#006666">;   PureBasic - TLS Server
</font><font color="#006666">;
</font><font color="#006666">;    (c) Fantaisie Software
</font><font color="#006666">;
</font><font color="#006666">; ------------------------------------------------------------
</font><font color="#006666">;
</font>
<b><font color="#006666">EnableExplicit</font></b>

<b><font color="#006666">Define</font></b>.i Con, Timeout, Length
<b><font color="#006666">Define</font></b> Receive$, Key$, Cert$, ClientID
<b><font color="#006666">Define</font></b> *Buffer

Key$ = &quot;-----BEGIN PRIVATE KEY-----&quot;+<font color="#924B72">#LF$</font>+
       &quot;MIICdQIBADANBgkqhkiG9w0BAQEFAASCAl8wggJbAgEAAoGBAPEbSQq/uwESZduPtDd83qXXkSPf6lUNa17xhM2fOZQxGr0Fdmvw6IsC+QGX25EE1TG6TFQkHlM2rW8y6a3WEC/WzCNWaTCPYD/rguiAFG+4eQmwHjiJFVec0InjjSG9SX8xwS/gQeWdQniKROO4DmMJO8N7mdUhdHODSntXdr9zAgMBAAECgYAE+VMgbaQl+YMwbF6DZogRU8kivFPRPV2hr8nVlBtT+09Z5uryfx3NAFqytbdJ3penVviMI9KcVNxvFtXLSEc9KyjzgysorAfUpwFuECCLDbOXX0HlV6rgkqJdhyV6FybcDLvgcvulHQ64QdYRhW+jPx7vXk3h0/JRFqKQJsY7QQJBAPrDLJRPbAw+Mlq1fHBWk8Z1Qn1ivPAmz+2nPAgDya/xdAlb9GbFAMzCS3upIBpxW70uLI04OuTVhwYL194I5C0CQQD2JHtHp25SkIDpBgZGicEC7yAIE/wPC0P9X85UJqXx5dPx4HbEc8lqSKMbCzkbHyvjHonSHu00QxU1W6ZALFYfAkBcPWzphSl+e2Z0XWvPutkS2FFD5A0R3YUAq1J2tEX9NTj0tGF7aB36M8ImU7jeYTJYrWJv8+4d/Ll1LOgT4XtlAkAxofOV5EYTsf28fzF+wcJAtDUyS81Uv0HLcqkpQM3PdDeDm253eJ2Rp+nzxxSRynxQBNVnoELWefxp0Pw6DnajAkBF5h7fQIbwAEPrhDzhjMXU7g9k9KzkkJN/bluLbleqkkAz1kfkGtWXJdGITZuY4K/X2yp1diWQ0utZjmOmhWsl&quot;+<font color="#924B72">#LF$</font>+
       &quot;-----END PRIVATE KEY-----&quot;

Cert$ = &quot;-----BEGIN CERTIFICATE-----&quot;+<font color="#924B72">#LF$</font>+
        &quot;MIICnTCCAgYCCQD0AWy2vzfcpzANBgkqhkiG9w0BAQUFADCBkjELMAkGA1UEBhMCVVMxDjAMBgNVBAgTBVN0YXRlMQ0wCwYDVQQHEwRDaXR5MRUwEwYDVQQKEwxPcmdhbml6YXRpb24xHDAaBgNVBAsTE09yZ2FuaXphdGlvbmFsIFVuaXQxLzAtBgNVBAMTJkNvbW1vbiBOYW1lIChlLmcuLCB5b3VyIHNlcnZlciBkb21haW4pMB4XDTI0MTEwNjE2NTI1N1oXDTI0MTIwNjE2NTI1N1owgZIxCzAJBgNVBAYTAlVTMQ4wDAYDVQQIEwVTdGF0ZTENMAsGA1UEBxMEQ2l0eTEVMBMGA1UEChMMT3JnYW5pemF0aW9uMRwwGgYDVQQLExNPcmdhbml6YXRpb25hbCBVbml0MS8wLQYDVQQDEyZDb21tb24gTmFtZSAoZS5nLiwgeW91ciBzZXJ2ZXIgZG9tYWluKTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA8RtJCr+7ARJl24+0N3zepdeRI9/qVQ1rXvGEzZ85lDEavQV2a/DoiwL5AZfbkQTVMbpMVCQeUzatbzLprdYQL9bMI1ZpMI9gP+uC6IAUb7h5CbAeOIkVV5zQieONIb1JfzHBL+BB5Z1CeIpE47gOYwk7w3uZ1SF0c4NKe1d2v3MCAwEAATANBgkqhkiG9w0BAQUFAAOBgQCprm5a5bg1LqCDdtwDTnRDmVcca6HoUlvbjZLmWdLjltG1McNAATppTy/bF7vT3jXLobA1Vzs2g14POjYQhPnIbRPEnNzvAe+Se3y0YeFOwYarEyFBHKHODGIPaCnXGH8gB9fgcp2SYtLaPKvXdNL44VeYGbD4+fvUcu/zkXqTSg==&quot;+<font color="#924B72">#LF$</font>+
        &quot;-----END CERTIFICATE-----&quot;

<font color="#006666">UseNetworkTLS</font>(Key$, Cert$)
Con =<font color="#006666"> CreateNetworkServer</font>(<font color="#924B72">#PB_Any</font>, 20252, <font color="#924B72">#PB_Network_TCP</font> | <font color="#924B72">#PB_Network_IPv4</font> | <font color="#924B72">#PB_Network_TLSv1_3</font>)
*Buffer =<font color="#006666"> AllocateMemory</font>(1000)

<b><font color="#006666">If</font></b> Con
  Timeout = 10000
  
    <b><font color="#006666">Repeat</font></b>
      <b><font color="#006666">Select</font></b> <font color="#006666">NetworkServerEvent</font>()
        <b><font color="#006666">Case</font></b> <font color="#924B72">#PB_NetworkEvent_Data</font>
          
          <b><font color="#006666">Debug</font></b> &quot;Data !&quot;
          ClientID =<font color="#006666"> EventClient</font>()
<font color="#006666">          PokeA</font>(*Buffer, 0)
          <b><font color="#006666">Debug</font></b> <font color="#006666">ReceiveNetworkData</font>(ClientID, *Buffer, 1000)
          
          <b><font color="#006666">Debug</font></b> &quot;String: &quot;+<font color="#006666">PeekS</font>(*Buffer, -1, <font color="#924B72">#PB_UTF8</font>)
<font color="#006666">          SendNetworkString</font>(ClientID, &quot;Well received !!!&quot;)
          
        <b><font color="#006666">Case</font></b> <font color="#924B72">#PB_NetworkEvent_None</font>
<font color="#006666">          Delay</font>(200)
          Timeout - 1
      <b><font color="#006666">EndSelect</font></b>
          
    <b><font color="#006666">Until</font></b> Timeout = 0
    
<font color="#006666">    CloseNetworkServer</font>(Con)
  <b><font color="#006666">Else</font></b>
    <b><font color="#006666">Debug</font></b> &quot;Can't create the server&quot;
<b><font color="#006666">EndIf</font></b>
</font></pre>
</body></html>
